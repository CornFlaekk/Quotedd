{% extends "skeleton.html" %}
{% block html_content %}

    Hola, {{ user.name }} <a href="/logout">Logout</a><br>

    <!-- Form to add new QUOTE -->
    <div class="container-sm p-3 card">
        <div class="col">
            <h4>Submit your Quote</h4>
        </div>
        <form action="/quote/add" method="post" id="addQuote">
            <div class="row flex-grow-1">
                <div class="col-md-8 position-relative">
                    <textarea class="form-control h-100 d-inline-block" name="quoteContent" id="quoteContent" placeholder="You got a new quote?"></textarea>
                </div>
                <div class="col me-3">
                    <div class="row pb-2">
                        <div class="input-group">
                            <div class="input-group-text">
                                Book&nbsp;
                                <i class="bi bi-book-fill"></i>
                            </div>
                            <input type="text" class="form-control" id="quoteBook" name="quoteBook">
                        </div>
                    </div>
                    <div class="row py-2">
                        <div class="input-group">
                            <div class="input-group-text">
                                Author&nbsp;
                                <i class="bi bi-person-fill"></i>
                            </div>
                            <input type="text" class="form-control" id="quoteAuthor" name="quoteAuthor">
                        </div>
                    </div>
                    <div class="row pt-2 px-2">
                        <button class="btn btn-primary" type="submit">Submit</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <!-- Form to add new QuoteList -->
    <h3>Create new QuoteList</h3>
    <form action="quotelists/add" method="post">
        <label for="quotelistName">Name:</label>
        <input type="text" id="quotelistName" name="quotelistName">
        <br>
        <label for="quotelistDesc">Description:</label>
        <input type="text" id="quotelistDesc" name="quotelistDesc">
        <br>
        <input type="submit">
    </form>

    <!-- Your Quotelists -->
    <!-- TODO: Este apartado estará en su propia página, para consultar tus listas -->
    <h3>Your QuoteLists</h3>
    <ol>
    {% for quotelist in quotelists %}
        <li>{{ quotelist.name }}</li>
            <ul>
                {% for quote in quotelist.quotes %}
                    <li>{{ quote.content }}</li>
                {% endfor %}
            </ul>
    {% endfor %}
    </ol>

    <!-- Show last 10 QUOTES on the DB -->
    <div class="container-sm card p-3">
        <h3>Recently submitted Quotes</h3>
    </div>
    {% for quote in last_quotes %}
        <div class="container-sm card p-3">
            <div class="row">
                <div class="col-md-auto">
                    <figure>
                        <blockquote class="blockquote">
                        <p>{{ quote.content }}</p>
                        </blockquote>
                        <figcaption class="blockquote-footer">
                        {{ quote.author }}, <cite title="Source Title">{{ quote.book }}</cite>
                        </figcaption>
                    </figure>
                </div>
                <!-- SELECT Quotelist to add in Dropdown Menu -->
                <div class="col input-group h-50">
                    <input type="hidden" name="quoteSafeID" id="quoteSafeID" value={{ quote.safe_id }}>
                    <button class="btn btn-outline-secondary dropdown-toggle border-0" type="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-plus-circle"></i>&nbsp;</button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        {% for quotelist_name in quote.quotelists_names %}
                            <li><a class="dropdown-item" href="#" onclick="location.href = '/quotelists/quotelist/add_quote?quotelistName={{quotelist_name}}&quoteSafeID={{quote.safe_id}}'">{{ quotelist_name }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <!-- Redirect to Quote page -->
            <a class="stretched-link" onclick="location.href = '/quote?quoteSafeID={{ quote.safe_id }}'" href="#"></a>
        </div>
    {% endfor %}
    
{% endblock %}